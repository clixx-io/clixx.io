/* Program

   A simple program created by the clixx.io generator now ready for 
   customisation.

*/

#include <stdio.h>
#include <string.h>
#include <avr/io.h>

#include "clixxIO.hpp"
#include "seriallinehander-config.hpp"

#define D1_I PB3
#define D1_O PB4
#define D1_S PB0

#define D2_I PB2
#define D2_O PB1
#define D2_S PB5

class App : public clixxIOApp{

  public:

    void setup(){
        /* setup Event handler

         This is a built in handler that will get called on startup
         and provides for initialisation requirements.

        */
        Serial.begin();
        Serial.echo = 1;
        Serial.puts("Serial Line Handler Example running at 19200 baud\r\n");

     	DDRB |= (1<<D1_O);    	///PB5 /digital 13 is an output

    };

    void serialline(){
        /* SerialLine Event handler
         
         * This gets called when a line is received. We check it to
         * see if it matches "On" and then print out that this was
         * what was expected. In other cases, the received line is echoed
         * back on the terminal.
         
        */
        
        if (strncmp(Serial.lastline(),"On",BUFFSIZE_LINELEN) == 0)
        {
            Serial.puts("Turn On instruction was received\n\r");
			PORTB |= (1<<D1_O);    		// Else turn pin on

        } else
        {
            Serial.puts("\r\nSerial line was :");
            Serial.puts(Serial.lastline());
            Serial.puts("\r\n");

			PORTB &= ~(1<<D1_O);    		// Turn pin off
        }

    };

};


// Main program Section. Simply setup an App class and let it run
int main(){
 
  App m;
  
  return m.run();

}

// Autogenerated interface between the event interface and application class
#include "seriallinehander-callbacks.cpp"
